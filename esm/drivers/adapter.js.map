{"version":3,"sources":["../../src/drivers/adapter.js"],"names":["React","Component","func","shape","string","ApolloClient","persistCache","ApolloContext","ApolloProvider","createHttpLink","InMemoryCache","Provider","ReduxProvider","Router","VeniaAdapter","apolloLink","apiBase","uri","apolloCache","cache","storage","window","localStorage","apolloClient","apollo","link","constructor","props","client","render","children","store","query","isRequired","request","readQuery","dispatch","getState","subscribe","replaceReducer"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { func, shape, string } from 'prop-types';\nimport { ApolloClient } from 'apollo-client';\nimport { persistCache } from 'apollo-cache-persist';\nimport { ApolloContext } from 'react-apollo/ApolloContext';\nimport { ApolloProvider } from 'react-apollo';\nimport { createHttpLink } from 'apollo-link-http';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { Router } from '@magento/peregrine';\n\n/**\n * The counterpart to \"@magento/venia-drivers\" is an adapter which provides\n * context objects to the driver dependencies. The default implementation in\n * 'src/drivers' uses components like 'react-apollo' and 'react-redux', which\n * have implicit external dependencies. This adapter provides all of them at\n * once.\n *\n * Consumers of Venia components can either implement a similar adapter and\n * wrap their Venia component trees with it, or they can override 'src/drivers'\n * so its components don't depend on context and IO.\n */\n\nexport default class VeniaAdapter extends Component {\n    static propTypes = {\n        apollo: shape({\n            client: shape({\n                query: func.isRequired\n            }),\n            link: shape({\n                request: func.isRequired\n            }),\n            cache: shape({\n                readQuery: func.isRequired\n            })\n        }),\n        store: shape({\n            dispatch: func.isRequired,\n            getState: func.isRequired,\n            subscribe: func.isRequired,\n            replaceReducer: func.isRequired\n        }).isRequired,\n        apiBase: string.isRequired\n    };\n    static apolloLink(apiBase) {\n        return createHttpLink({\n            uri: apiBase\n        });\n    }\n    static apolloCache() {\n        const cache = new InMemoryCache();\n\n        persistCache({\n            cache,\n            storage: window.localStorage\n        });\n\n        return cache;\n    }\n    static apolloClient({ apiBase, apollo: { cache, link } = {} }) {\n        return new ApolloClient({\n            link: link || VeniaAdapter.apolloLink(apiBase),\n            cache: cache || VeniaAdapter.apolloCache()\n        });\n    }\n\n    constructor(props) {\n        super(props);\n        const apollo = this.props.apollo || {};\n        this.apolloClient =\n            apollo.client || VeniaAdapter.apolloClient(this.props);\n    }\n\n    /*\n     * TODO: consolidate react-apollo context providers\n     *\n     * They think they're using the new context API, but they're not.\n     * https://github.com/apollographql/react-apollo/pull/2540\n     *\n     * Need ApolloProvider for Query and ApolloConsumer.\n     * Need ApolloContext for useContext.\n     */\n    render() {\n        const { children, store, apiBase } = this.props;\n        return (\n            <ApolloContext.Provider value={this.apolloClient}>\n                <ApolloProvider client={this.apolloClient}>\n                    <ReduxProvider store={store}>\n                        <Router apiBase={apiBase}>{children}</Router>\n                    </ReduxProvider>\n                </ApolloProvider>\n            </ApolloContext.Provider>\n        );\n    }\n}\n"],"file":"adapter.js"}