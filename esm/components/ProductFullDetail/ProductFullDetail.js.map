{"version":3,"sources":["../../../src/components/ProductFullDetail/ProductFullDetail.js"],"names":["React","Suspense","useCallback","useState","arrayOf","bool","func","number","shape","string","Form","Price","defaultClasses","mergeClasses","Button","loadingIndicator","Carousel","Quantity","RichText","appendOptionsToPayload","findMatchingVariant","isProductConfigurable","Options","lazy","INITIAL_OPTION_CODES","Map","INITIAL_OPTION_SELECTIONS","INITIAL_QUANTITY","deriveOptionCodesFromProduct","product","initialOptionCodes","configurable_options","attribute_id","attribute_code","set","getIsMissingOptions","optionSelections","numProductOptions","length","numProductSelections","size","getMediaGalleryEntries","optionCodes","value","media_gallery_entries","variants","isConfigurable","optionsSelected","item","key","reduce","fullKey","entry","file","ProductFullDetail","props","addToCart","isAddingItem","quantity","setQuantity","setOptionSelections","derivedOptionCodes","amount","productPrice","price","regularPrice","classes","isMissingOptions","mediaGalleryEntries","handleAddToCart","payload","productType","__typename","handleSelectionChange","optionId","selection","newOptionSelections","Array","from","pop","root","title","productName","name","currency","imageCarousel","options","quantityTitle","cartActions","description","descriptionTitle","details","detailsTitle","sku","propTypes","isRequired","id","label","position","disabled"],"mappings":"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","sourcesContent":["import React, { Suspense, useCallback, useState } from 'react';\nimport { arrayOf, bool, func, number, shape, string } from 'prop-types';\nimport { Form } from 'informed';\nimport { Price } from '@magento/peregrine';\n\nimport defaultClasses from './productFullDetail.css';\nimport { mergeClasses } from 'src/classify';\n\nimport Button from 'src/components/Button';\nimport { loadingIndicator } from 'src/components/LoadingIndicator';\nimport Carousel from 'src/components/ProductImageCarousel';\nimport Quantity from 'src/components/ProductQuantity';\nimport RichText from 'src/components/RichText';\n\nimport appendOptionsToPayload from 'src/util/appendOptionsToPayload';\nimport findMatchingVariant from 'src/util/findMatchingProductVariant';\nimport isProductConfigurable from 'src/util/isProductConfigurable';\n\nconst Options = React.lazy(() => import('../ProductOptions'));\n\nconst INITIAL_OPTION_CODES = new Map();\nconst INITIAL_OPTION_SELECTIONS = new Map();\nconst INITIAL_QUANTITY = 1;\n\nconst deriveOptionCodesFromProduct = product => {\n    // If this is a simple product it has no option codes.\n    if (!isProductConfigurable(product)) {\n        return INITIAL_OPTION_CODES;\n    }\n\n    // Initialize optionCodes based on the options of the product.\n    const initialOptionCodes = new Map();\n    for (const {\n        attribute_id,\n        attribute_code\n    } of product.configurable_options) {\n        initialOptionCodes.set(attribute_id, attribute_code);\n    }\n\n    return initialOptionCodes;\n};\n\nconst getIsMissingOptions = (product, optionSelections) => {\n    // Non-configurable products can't be missing options.\n    if (!isProductConfigurable(product)) {\n        return false;\n    }\n\n    // Configurable products are missing options if we have fewer\n    // option selections than the product has options.\n    const { configurable_options } = product;\n    const numProductOptions = configurable_options.length;\n    const numProductSelections = optionSelections.size;\n\n    return numProductSelections < numProductOptions;\n};\n\nconst getMediaGalleryEntries = (product, optionCodes, optionSelections) => {\n    let value = [];\n\n    const { media_gallery_entries, variants } = product;\n    const isConfigurable = isProductConfigurable(product);\n    const optionsSelected = optionSelections.size > 0;\n\n    if (!isConfigurable || !optionsSelected) {\n        value = media_gallery_entries;\n    } else {\n        const item = findMatchingVariant({\n            optionCodes,\n            optionSelections,\n            variants\n        });\n\n        value = item\n            ? [...item.product.media_gallery_entries, ...media_gallery_entries]\n            : media_gallery_entries;\n    }\n\n    const key = value.reduce((fullKey, entry) => {\n        return `${fullKey},${entry.file}`;\n    }, '');\n\n    return { key, value };\n};\n\nconst ProductFullDetail = props => {\n    // Props.\n    const { addToCart, isAddingItem, product } = props;\n\n    // State.\n    const [quantity, setQuantity] = useState(INITIAL_QUANTITY);\n    const [optionSelections, setOptionSelections] = useState(\n        INITIAL_OPTION_SELECTIONS\n    );\n    const derivedOptionCodes = deriveOptionCodesFromProduct(product);\n    const [optionCodes] = useState(derivedOptionCodes);\n\n    // Members.\n    const { amount: productPrice } = product.price.regularPrice;\n    const classes = mergeClasses(defaultClasses, props.classes);\n    const isMissingOptions = getIsMissingOptions(product, optionSelections);\n    const mediaGalleryEntries = getMediaGalleryEntries(\n        product,\n        optionCodes,\n        optionSelections\n    );\n\n    // Event handlers.\n    const handleAddToCart = useCallback(() => {\n        const payload = {\n            item: product,\n            productType: product.__typename,\n            quantity\n        };\n\n        if (isProductConfigurable(product)) {\n            appendOptionsToPayload(payload, optionSelections, optionCodes);\n        }\n\n        addToCart(payload);\n    }, [addToCart, optionCodes, optionSelections, product, quantity]);\n\n    const handleSelectionChange = useCallback(\n        (optionId, selection) => {\n            // We must create a new Map here so that React knows that the value\n            // of optionSelections has changed.\n            const newOptionSelections = new Map([...optionSelections]);\n            newOptionSelections.set(optionId, Array.from(selection).pop());\n            setOptionSelections(newOptionSelections);\n        },\n        [optionSelections]\n    );\n\n    return (\n        <Form className={classes.root}>\n            <section className={classes.title}>\n                <h1 className={classes.productName}>{product.name}</h1>\n                <p className={classes.productPrice}>\n                    <Price\n                        currencyCode={productPrice.currency}\n                        value={productPrice.value}\n                    />\n                </p>\n            </section>\n            <section className={classes.imageCarousel}>\n                <Carousel\n                    images={mediaGalleryEntries.value}\n                    key={mediaGalleryEntries.key}\n                />\n            </section>\n            <section className={classes.options}>\n                <Suspense fallback={loadingIndicator}>\n                    <Options\n                        onSelectionChange={handleSelectionChange}\n                        product={product}\n                    />\n                </Suspense>\n            </section>\n            <section className={classes.quantity}>\n                <h2 className={classes.quantityTitle}>Quantity</h2>\n                <Quantity initialValue={quantity} onValueChange={setQuantity} />\n            </section>\n            <section className={classes.cartActions}>\n                <Button\n                    priority=\"high\"\n                    onClick={handleAddToCart}\n                    disabled={isAddingItem || isMissingOptions}\n                >\n                    Add to Cart\n                </Button>\n            </section>\n            <section className={classes.description}>\n                <h2 className={classes.descriptionTitle}>\n                    Product Description\n                </h2>\n                <RichText content={product.description} />\n            </section>\n            <section className={classes.details}>\n                <h2 className={classes.detailsTitle}>SKU</h2>\n                <strong>{product.sku}</strong>\n            </section>\n        </Form>\n    );\n};\n\nProductFullDetail.propTypes = {\n    addToCart: func.isRequired,\n    classes: shape({\n        cartActions: string,\n        description: string,\n        descriptionTitle: string,\n        details: string,\n        detailsTitle: string,\n        imageCarousel: string,\n        options: string,\n        productName: string,\n        productPrice: string,\n        quantity: string,\n        quantityTitle: string,\n        root: string,\n        title: string\n    }),\n    isAddingItem: bool,\n    product: shape({\n        __typename: string,\n        id: number,\n        sku: string.isRequired,\n        price: shape({\n            regularPrice: shape({\n                amount: shape({\n                    currency: string.isRequired,\n                    value: number.isRequired\n                })\n            }).isRequired\n        }).isRequired,\n        media_gallery_entries: arrayOf(\n            shape({\n                label: string,\n                position: number,\n                disabled: bool,\n                file: string.isRequired\n            })\n        ),\n        description: string\n    }).isRequired\n};\n\nexport default ProductFullDetail;\n"],"file":"ProductFullDetail.js"}